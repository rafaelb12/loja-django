{% extends "produtos/base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="container mt-5">
  <h2 class="mb-4 text-center">Meu Perfil</h2>

  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body text-center p-4">

          <!-- Foto do perfil com ícone de edição -->
          <div class="position-relative d-inline-block mb-4">
            {% if profile.foto %}
              <img id="fotoPerfil" src="{{ profile.foto.url }}" alt="Foto de perfil" class="rounded-circle border" width="150" height="150">
            {% else %}
              <img id="fotoPerfil" src="{% static 'imagens/default_user.png' %}" alt="Sem foto" class="rounded-circle border" width="150" height="150">
            {% endif %}

            <!-- Ícone lápis sobre a foto -->
            <label for="foto" class="position-absolute bottom-0 end-0 bg-white rounded-circle p-2 shadow" style="cursor:pointer;">
              <i class="bi bi-pencil-fill"></i>
            </label>
            <input type="file" id="foto" name="foto" style="display:none;">
          </div>

          <!-- Formulário inline -->
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <p><strong>Usuário:</strong> {{ profile.user.username }}</p>
            <p><strong>Email:</strong> {{ profile.user.email }}</p>

            <!-- Telefone -->
            <div class="d-flex align-items-center justify-content-center mb-3">
              <strong class="me-2">Telefone:</strong>
              <input type="text" name="telefone" class="form-control w-auto" value="{{ profile.telefone|default:'' }}" readonly>
              <i class="bi bi-pencil-fill ms-2 text-primary btn-editar" style="cursor:pointer;"></i>
            </div>

            <!-- Endereço -->
            <div class="d-flex align-items-center justify-content-center mb-3">
              <strong class="me-2">Endereço:</strong>
              <input type="text" name="endereco" class="form-control w-auto" value="{{ profile.endereco|default:'' }}" readonly>
              <i class="bi bi-pencil-fill ms-2 text-primary btn-editar" style="cursor:pointer;"></i>
            </div>

            <button type="submit" class="btn btn-success mt-3">Salvar Alterações</button>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- JS para edição inline e preview da foto -->
<script>
  // Edição inline dos campos
  document.querySelectorAll('.btn-editar').forEach(function(btn){
    btn.addEventListener('click', function(){
      const input = btn.previousElementSibling;
      input.removeAttribute('readonly');
      input.focus();
    });
  });

  // Preview da foto
  const fotoInput = document.getElementById('foto');
  const fotoImg = document.getElementById('fotoPerfil');

  fotoInput.addEventListener('change', function(e){
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = function(e){
        fotoImg.src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
  });
</script>

<style>
  /* Transição suave ao editar campos */
  input[readonly] {
    background-color: #f8f9fa;
    border: none;
    transition: background-color 0.3s, border 0.3s;
  }

  input:not([readonly]) {
    background-color: #fff;
    border: 1px solid #0d6efd;
  }

  .btn-editar:hover {
    color: #0d6efd;
  }
</style>
{% endblock %}
