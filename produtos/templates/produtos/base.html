{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="Website Icon" type="png" href="https://cdn-icons-png.flaticon.com/512/4273/4273333.png">
  <title>Minha Loja</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; }
    .navbar { background-color: #111; }
    .navbar .nav-link, .navbar-brand { color: #fff !important; }
    .search-bar { width: 400px; 
      color: black; background-color: white; }
    .hero { 
      background: url("https://via.placeholder.com/1200x400/ff6f61/ffffff?text=Promoção+Especial") center/cover; 
      height: 400px; 
      display: flex; 
      align-items: center; 
      justify-content: center; color: white; text-align: center; }
    .hero h1 { 
      font-size: 2.5rem; 
      font-weight: bold; }
    .card img { 
      height: 220px; 
      object-fit: cover; }
    footer { 
      background: #111; 
      color: #fff; 
      text-align: center; 
      padding: 20px; 
      margin-top: 50px; }
    .search-bar::placeholder {
    color: #555; 
    }
    .btn-toggle-curtir {
    display: inline-block;
    font-size: 1.3rem;
}

.btn-toggle-curtir .badge {
    font-size: 0.7rem;
    padding: 0.35em 0.45em;
}
    #suggestions a.list-group-item {
    cursor: pointer;
    background-color: #fff;}
    #suggestions a.list-group-item:hover {
    background-color: #f0f0f0;}


  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="{% url 'lista_produtos' %}">Minha Loja</a>
<form class="d-flex ms-auto me-3 position-relative" method="get" action="{% url 'lista_produtos' %}">
  <input id="search-input" class="form-control search-bar me-2" type="search" placeholder="Buscar produtos..." name="q" autocomplete="off">
  <button class="btn btn-outline-light" type="submit"><i class="fas fa-search"></i></button>

  <!-- Container para sugestões -->
  <div id="suggestions" class="list-group position-absolute w-100" style="top:100%; left:0; z-index: 1000;"></div>
</form>

   <ul class="navbar-nav d-flex flex-row">
  <li class="nav-item mx-2">
    <a class="nav-link" href="{% url 'produtos_curtidos' %}"><i class="fas fa-heart"></i></a>
  </li>
  <li class="nav-item mx-2">
    <a class="nav-link" href="{% url 'ver_carrinho' %}"><i class="fas fa-shopping-cart"></i></a>
  </li>
  <li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownCategorias" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="fas fa-th-large"></i> <!-- ícone de grade de produtos -->
  </a>
  <ul class="dropdown-menu" aria-labelledby="navbarDropdownCategorias">
    {% for cat in categorias %}
      <li>
        <a class="dropdown-item" href="{% url 'lista_produtos' %}?categoria={{ cat.id }}">
          {% if cat.icone %}
            <i class="{{ cat.icone }} me-2"></i>
          {% endif %}
          {{ cat.nome }}
        </a>
      </li>
    {% endfor %}
  </ul>
</li>

  {% if user.is_authenticated %}
  <li class="nav-item dropdown mx-2">
    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
      <i class="fas fa-user"></i> {{ user.username }}
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="{% url 'dashboard_usuario' %}">Meus Pedidos</a></li>
      <li><a class="dropdown-item" href="{% url 'perfil_usuario' %}">Perfil</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item" href="{% url 'logout_usuario' %}">Sair</a></li>
    </ul>
  </li>
  {% else %}
  <li class="nav-item mx-2">
    <a class="nav-link" href="{% url 'login_usuario' %}"><i class="fas fa-user"></i></a>
  </li>
  {% endif %}
</ul>


  </div>
</nav>

<!-- Hero Banner -->
{% if request.path == '/' %}
<div class="hero" style="
    background: url('https://criaufmg.com.br/wp-content/uploads/2024/05/Capa-1-layout-de-site.png') center center / cover no-repeat;
    height: 600px;
">
</div>
{% endif %}




<!-- Ofertas Dinâmicas -->
 <div class="container my-5">
    {% block content %}
    <!-- Conteúdo específico das páginas será inserido aqui -->
    {% endblock %}
  </div>

<!-- Footer -->
<footer>
  <p>&copy; 2025 Minha Loja - Todos os direitos reservados</p>
</footer>

<script>
const input = document.getElementById('search-input');
const suggestions = document.getElementById('suggestions');

input.addEventListener('input', function() {
    const query = this.value;
    if(query.length > 0){
        fetch(`/sugestoes/?q=${query}`)
        .then(response => response.json())
        .then(data => {
            suggestions.innerHTML = '';
            data.forEach(item => {
                const a = document.createElement('a');
                a.href = `/produtos/${item.id}/`;  // link para o detalhe do produto
                a.classList.add('list-group-item', 'list-group-item-action');
                a.textContent = item.nome;
                suggestions.appendChild(a);
            });
        });
    } else {
        suggestions.innerHTML = '';
    }
});

// Esconder sugestões ao clicar fora
document.addEventListener('click', function(e){
    if(!input.contains(e.target) && !suggestions.contains(e.target)){
        suggestions.innerHTML = '';
    }
});
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).on("click", ".btn-toggle-curtir", function(e) {
    e.preventDefault();

    let btn = $(this);
    let produtoId = btn.data("id");

    $.ajax({
    url: `/produtos/${produtoId}/toggle-curtir/`,
    method: "POST",
    headers: {
        "X-CSRFToken": "{{ csrf_token }}"
    },
    success: function(response) {
        if (response.curtido) {
            btn.find("i").removeClass("far").addClass("fas text-danger");
        } else {
            btn.find("i").removeClass("fas text-danger").addClass("far");
        }

        // Atualiza o badge
        btn.find(".badge").text(response.total_curtidas);
    },
    error: function() {
        alert("Você precisa estar logado para curtir produtos!");
    }
});

});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
